default_platform(:ios)

platform :ios do
  desc "Upload Flutter-built IPA to TestFlight"
  lane :beta do
    # Flutter outputs IPA here (relative to project root)
    ipa_path = File.expand_path("../../build/ios/ipa/Runner.ipa", __FILE__)

    # Check if file exists
    unless File.exist?(ipa_path)
      UI.user_error!("Could not find IPA at path: #{ipa_path}")
    end

    upload_to_testflight(
      ipa: ipa_path,
      skip_waiting_for_build_processing: true,
      api_key: {
        key_id: ENV["APP_STORE_CONNECT_KEY_ID"],
        issuer_id: ENV["APP_STORE_CONNECT_ISSUER_ID"],
        key_content: ENV["APP_STORE_CONNECT_API_KEY"],
        is_key_content_base64: false
      }
    )
  end
end
